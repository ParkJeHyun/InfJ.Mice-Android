package kr.co.iekorea.mc;import kr.co.iekorea.mc.staticdata.StaticData;import kr.co.iekorea.mc.util.BaseInterface;import kr.co.iekorea.mc.util.ProcessManager;import kr.co.iekorea.mc.util.WeakAsyncTask;import kr.co.iekorea.mc.xml.QuestionDTO;import kr.co.iekorea.mc.xml.SurveyDAO;import android.app.Activity;import android.content.Intent;import android.os.Bundle;import android.view.View;import android.view.View.OnClickListener;import android.widget.EditText;import android.widget.ImageButton;import android.widget.LinearLayout;import android.widget.LinearLayout.LayoutParams;import android.widget.TextView;import android.widget.Toast;public class SurveyQuestionModify_Activity extends Activity implements		BaseInterface {	// Activity control.	private ProcessManager processManager;	// layout area	private ImageButton btn_back;	private LinearLayout layout_header;	private LinearLayout layout_progressbar;		// intent 	public int research_id;	public int research_q_id;		// contents	public ImageButton btn_ok;	public EditText edit_title,edit_answer_a,edit_answer_b,edit_answer_c,edit_answer_d,edit_answer_e;	private QuestionDTO item;		public TextView total_title,info_question,info_answer,text_wait;		@Override	protected void onCreate(Bundle savedInstanceState) {		// TODO Auto-generated method stub		super.onCreate(savedInstanceState);		this.initView();		if (StaticData.logined) {			this.getIntentValues();			this.getXmlResources();			this.modifyXmlResources();						new setQuestionInfo(SurveyQuestionModify_Activity.this).execute();					} else {			switch (StaticData.NOWLANGUAGE) {			case StaticData.KOREA:			Toast.makeText(getApplicationContext(),			R.string.please_retry_ko, Toast.LENGTH_SHORT).show();			break;			case StaticData.ENGLISH:			Toast.makeText(getApplicationContext(),			R.string.please_retry_en, Toast.LENGTH_SHORT).show();			break;			case StaticData.CHINA:			Toast.makeText(getApplicationContext(),			R.string.please_retry_cn, Toast.LENGTH_SHORT).show();			break;			}			Intent intent = new Intent(getApplicationContext(),Login_Activity.class);			startActivity(intent);			overridePendingTransition(android.R.anim.fade_in,android.R.anim.fade_out);			finish();		}	}		public void getIntentValues(){		this.research_id = getIntent().getIntExtra("research_id", 0);		this.research_q_id = getIntent().getIntExtra("research_q_id",0);	}		@Override	protected void onDestroy() {		super.onDestroy();		this.processManager.deleteActivity(this);	}		@Override	public void onBackPressed() {		Intent intent = new Intent(getApplicationContext(), SurveyQuestionView_Activity.class);		intent.putExtra("research_id", research_id);		intent.putExtra("research_q_id", research_q_id);		startActivity(intent);		finish();	}		@Override	public void finish() {		super.finish();		overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);	}	@Override	public void initView() {		this.setContentView(R.layout.activity_surveyquestion_modify);		this.processManager = ProcessManager.getInstance();		this.processManager.addActivity(this);	}	@Override	public void getXmlResources() {		this.btn_back = (ImageButton) this.findViewById(R.id.btn_back);		this.layout_header = (LinearLayout) this.findViewById(R.id.layout_header);		this.layout_progressbar = (LinearLayout) this.findViewById(R.id.layout_progressbar);				// contents		this.btn_ok = (ImageButton) this.findViewById(R.id.btn_ok);		this.edit_answer_a = (EditText) this.findViewById(R.id.edit_answer_a);		this.edit_answer_b = (EditText) this.findViewById(R.id.edit_answer_b);		this.edit_answer_c = (EditText) this.findViewById(R.id.edit_answer_c);		this.edit_answer_d = (EditText) this.findViewById(R.id.edit_answer_d);		this.edit_answer_e = (EditText) this.findViewById(R.id.edit_answer_e);		this.edit_title = (EditText) this.findViewById(R.id.edit_title);				this.total_title = (TextView) this.findViewById(R.id.total_title);		this.info_question = (TextView) this.findViewById(R.id.info_question);		this.info_answer = (TextView) this.findViewById(R.id.info_answer);		this.text_wait = (TextView) this.findViewById(R.id.text_wait);	}	@Override	public void modifyXmlResources() {		LayoutParams param;        param = new LayoutParams(LayoutParams.MATCH_PARENT,StaticData.device_Height/10);        this.layout_header.setLayoutParams(param);                // 언어 설정에 다른 화면 구성		switch (StaticData.NOWLANGUAGE) {		case StaticData.KOREA:			this.btn_back.setImageResource(R.drawable.b_back_kr);			this.total_title.setText(R.string.survey_ko);			this.text_wait.setText(R.string.wait_ko);			this.info_question.setText(R.string.question_ko);			this.btn_ok.setImageResource(R.drawable.b_save_kr);			this.info_answer.setText(R.string.answer_ko);			break;		case StaticData.ENGLISH:			this.btn_back.setImageResource(R.drawable.b_back_en);			this.total_title.setText(R.string.survey_en);			this.info_question.setText(R.string.question_en);			this.btn_ok.setImageResource(R.drawable.b_save_en);			this.text_wait.setText(R.string.wait_en);			this.info_answer.setText(R.string.answer_en);			break;		case StaticData.CHINA:			this.btn_back.setImageResource(R.drawable.b_back_cn);			this.total_title.setText(R.string.survey_cn);			this.info_question.setText(R.string.question_cn);			this.btn_ok.setImageResource(R.drawable.b_save_cn);			this.text_wait.setText(R.string.wait_cn);			this.info_answer.setText(R.string.answer_cn);			break;		}	}	@Override	public void setEventListener() {		this.btn_back.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View v) {				Intent intent = new Intent(getApplicationContext(), SurveyQuestionView_Activity.class);				intent.putExtra("research_id", research_id);				intent.putExtra("research_q_id", research_q_id);				startActivity(intent);				finish();			}		});				this.btn_ok.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View v) {				if(checkInputValues()){					new setUpdateQuestion(SurveyQuestionModify_Activity.this).execute();				}else{				}			}		});	}		public boolean checkInputValues(){		boolean result = false;		int count = 0;		if(edit_title.getText().toString().trim().equals("")){			switch (StaticData.NOWLANGUAGE) {			case StaticData.KOREA:			Toast.makeText(getApplicationContext(),			R.string.please_enter_the_title_ko, Toast.LENGTH_SHORT).show();			break;			case StaticData.ENGLISH:			Toast.makeText(getApplicationContext(),			R.string.please_enter_the_title_en, Toast.LENGTH_SHORT).show();			break;			case StaticData.CHINA:			Toast.makeText(getApplicationContext(),			R.string.please_enter_the_title_cn, Toast.LENGTH_SHORT).show();			break;			}		}else{			for(int i=0; i<5; i++){				switch(i){				case 0:					if(edit_answer_a.getText().toString().trim().equals("")) count ++;					break;				case 1:					if(edit_answer_b.getText().toString().trim().equals("")) count ++;					break;				case 2:					if(edit_answer_c.getText().toString().trim().equals("")) count ++;					break;				case 3:					if(edit_answer_d.getText().toString().trim().equals("")) count ++;					break;				case 4:					if(edit_answer_e.getText().toString().trim().equals("")) count ++;					break;				}			}						if(count < 4){				result = true;			}else{				switch (StaticData.NOWLANGUAGE) {				case StaticData.KOREA:				Toast.makeText(getApplicationContext(),				R.string.please_enter_over_two_answer_ko, Toast.LENGTH_SHORT).show();				break;				case StaticData.ENGLISH:				Toast.makeText(getApplicationContext(),				R.string.please_enter_over_two_answer_en, Toast.LENGTH_SHORT).show();				break;				case StaticData.CHINA:				Toast.makeText(getApplicationContext(),				R.string.please_enter_over_two_answer_cn, Toast.LENGTH_SHORT).show();				break;				}				result = false;			}		}				return result;	}		// back ground	public void upDateList(){		this.edit_title.setText(item.QUESTION_TITLE);		for(int i=0;i<item.RESEARCH_ANSWER.size();i++){			switch(i){			case 0:				this.edit_answer_a.setText(item.RESEARCH_ANSWER.get(i).ANSWER_TITLE);				break;			case 1:				this.edit_answer_b.setText(item.RESEARCH_ANSWER.get(i).ANSWER_TITLE);				break;			case 2:				this.edit_answer_c.setText(item.RESEARCH_ANSWER.get(i).ANSWER_TITLE);				break;			case 3:				this.edit_answer_d.setText(item.RESEARCH_ANSWER.get(i).ANSWER_TITLE);				break;			case 4:				this.edit_answer_e.setText(item.RESEARCH_ANSWER.get(i).ANSWER_TITLE);				break;			}		}	}		// back ground	class setQuestionInfo extends WeakAsyncTask<Void, Void, Void, Activity>{		boolean result = false;		public setQuestionInfo(Activity target) {			super(target);		}				@Override		protected void onPreExecute(Activity target) {			layout_progressbar.setVisibility(LinearLayout.VISIBLE);		}		@Override		protected Void doInBackground(Activity target, Void... params) {			SurveyDAO dao = new SurveyDAO(SurveyQuestionModify_Activity.this);			try {				result = dao.setQuestionInfo(research_id,research_q_id);			} catch (Exception e) {				result = false;			}			if(result){								if(item != null){					item = new QuestionDTO();				}				item = dao.getQuestionInfo();			}			return null;		}				@Override		protected void onPostExecute(Activity target, Void result) {			if(this.result){				upDateList();			}else{				switch (StaticData.NOWLANGUAGE) {				case StaticData.KOREA:				Toast.makeText(getApplicationContext(),				R.string.please_retry_ko, Toast.LENGTH_SHORT).show();				break;				case StaticData.ENGLISH:				Toast.makeText(getApplicationContext(),				R.string.please_retry_en, Toast.LENGTH_SHORT).show();				break;				case StaticData.CHINA:				Toast.makeText(getApplicationContext(),				R.string.please_retry_cn, Toast.LENGTH_SHORT).show();				break;				}			}			setEventListener();			layout_progressbar.setVisibility(LinearLayout.GONE);		}	}	class setUpdateQuestion extends WeakAsyncTask<Void, Void, Void, Activity>{		boolean result = false;		public setUpdateQuestion(Activity target) {			super(target);		}				@Override		protected void onPreExecute(Activity target) {			layout_progressbar.setVisibility(LinearLayout.VISIBLE);		}		@Override		protected Void doInBackground(Activity target, Void... params) {			SurveyDAO dao = new SurveyDAO(SurveyQuestionModify_Activity.this);			try {				result = dao.setUpdateQuestion(research_id,research_q_id,edit_title.getText().toString().trim(),						edit_answer_a.getText().toString().trim(),						edit_answer_b.getText().toString().trim(),						edit_answer_c.getText().toString().trim(),						edit_answer_d.getText().toString().trim(),						edit_answer_e.getText().toString().trim());			} catch (Exception e) {				result = false;			}			return null;		}				@Override		protected void onPostExecute(Activity target, Void result) {			if(this.result){				Intent intent = new Intent(getApplicationContext(), SurveyQuestionView_Activity.class);				intent.putExtra("research_id", research_id);				intent.putExtra("research_q_id", research_q_id);				startActivity(intent);				finish();			}else{				switch (StaticData.NOWLANGUAGE) {				case StaticData.KOREA:				Toast.makeText(getApplicationContext(),				R.string.please_retry_ko, Toast.LENGTH_SHORT).show();				break;				case StaticData.ENGLISH:				Toast.makeText(getApplicationContext(),				R.string.please_retry_en, Toast.LENGTH_SHORT).show();				break;				case StaticData.CHINA:				Toast.makeText(getApplicationContext(),				R.string.please_retry_cn, Toast.LENGTH_SHORT).show();				break;				}			}			layout_progressbar.setVisibility(LinearLayout.GONE);		}	}	}