package kr.co.iekorea.mc;import kr.co.iekorea.mc.adapter.SurveyResultViewPagerAdapter;import kr.co.iekorea.mc.staticdata.StaticData;import kr.co.iekorea.mc.util.BaseInterface;import kr.co.iekorea.mc.util.ProcessManager;import kr.co.iekorea.mc.util.WeakAsyncTask;import kr.co.iekorea.mc.xml.SurveyDAO;import kr.co.iekorea.mc.xml.SurveyResultDTO;import android.app.Activity;import android.content.Intent;import android.os.Bundle;import android.support.v4.view.ViewPager;import android.view.GestureDetector;import android.view.GestureDetector.SimpleOnGestureListener;import android.view.MotionEvent;import android.view.View;import android.view.View.OnClickListener;import android.view.View.OnTouchListener;import android.widget.Button;import android.widget.ImageButton;import android.widget.LinearLayout;import android.widget.LinearLayout.LayoutParams;import android.widget.TextView;import android.widget.Toast;public class SurveyResult_Activity extends Activity implements BaseInterface {	// Activity control.	private ProcessManager processManager;	// layout area	private ImageButton btn_back;	private LinearLayout layout_header;	private LinearLayout layout_progressbar;		// intent	private int research_id;		// items	public SurveyResultDTO item;		// contents	public TextView RESEARCH_TITLE,RESEARCH_MAKER,RESEARCH_TOTAL_COUNT;	public ImageButton btn_pre,btn_next,btn_final;	public ViewPager pager;	public SurveyResultViewPagerAdapter adapter;		// 언어	public TextView total_title,info_draftsman,info_respondent,text_wait;		@Override	protected void onCreate(Bundle savedInstanceState) {		// TODO Auto-generated method stub		super.onCreate(savedInstanceState);		this.initView();		if (StaticData.logined) {			this.getIntentValues();			this.getXmlResources();			this.modifyXmlResources();						new setSurveyResult(SurveyResult_Activity.this).execute();		} else {			switch (StaticData.NOWLANGUAGE) {			case StaticData.KOREA:			Toast.makeText(getApplicationContext(),			R.string.please_retry_ko, Toast.LENGTH_SHORT).show();			break;			case StaticData.ENGLISH:			Toast.makeText(getApplicationContext(),			R.string.please_retry_en, Toast.LENGTH_SHORT).show();			break;			case StaticData.CHINA:			Toast.makeText(getApplicationContext(),			R.string.please_retry_cn, Toast.LENGTH_SHORT).show();			break;			}			Intent intent = new Intent(getApplicationContext(),Login_Activity.class);			startActivity(intent);			overridePendingTransition(android.R.anim.fade_in,android.R.anim.fade_out);			finish();		}	}		public void getIntentValues(){		this.research_id = getIntent().getIntExtra("research_id", 0);	}		@Override	protected void onDestroy() {		super.onDestroy();		this.processManager.deleteActivity(this);	}		@Override	public void onBackPressed() {		Intent intent = new Intent(getApplicationContext(), Survey_Activity.class);		startActivity(intent);		finish();	}		@Override	public void finish() {		super.finish();		overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);	}	@Override	public void initView() {		this.setContentView(R.layout.activity_survey_result);		this.processManager = ProcessManager.getInstance();		this.processManager.addActivity(this);	}	@Override	public void getXmlResources() {		this.btn_back = (ImageButton) this.findViewById(R.id.btn_back);		this.layout_header = (LinearLayout) this.findViewById(R.id.layout_header);		this.layout_progressbar = (LinearLayout) this.findViewById(R.id.layout_progressbar);				// contents		this.RESEARCH_TITLE = (TextView) this.findViewById(R.id.RESEARCH_TITLE);		this.RESEARCH_MAKER = (TextView) this.findViewById(R.id.RESEARCH_MAKER);		this.RESEARCH_TOTAL_COUNT = (TextView) this.findViewById(R.id.RESEARCH_TOTAL_COUNT);				// buttton		this.btn_pre = (ImageButton) this.findViewById(R.id.btn_pre);		this.btn_next = (ImageButton) this.findViewById(R.id.btn_next);		this.btn_final = (ImageButton) this.findViewById(R.id.btn_final);				// view pager		this.pager = (ViewPager) this.findViewById(R.id.list_viewpager);		this.total_title = (TextView) this.findViewById(R.id.total_title);		this.text_wait = (TextView) this.findViewById(R.id.text_wait);		this.info_draftsman = (TextView) this.findViewById(R.id.info_draftsman);		this.info_respondent = (TextView) this.findViewById(R.id.info_respondent);	}	@Override	public void modifyXmlResources() {		LayoutParams param;        param = new LayoutParams(LayoutParams.MATCH_PARENT,StaticData.device_Height/10);        this.layout_header.setLayoutParams(param);        // 언어 설정에 다른 화면 구성		switch (StaticData.NOWLANGUAGE) {		case StaticData.KOREA:			this.btn_back.setImageResource(R.drawable.b_back_kr);			this.total_title.setText(R.string.survey_ko);			this.text_wait.setText(R.string.wait_ko);			this.btn_pre.setImageResource(R.drawable.b_prev_kr);			this.btn_next.setImageResource(R.drawable.b_next_kr);			this.btn_final.setImageResource(R.drawable.b3_confirm_kr);			this.info_draftsman.setText(R.string.draftsman_ko);			this.info_respondent.setText(R.string.respondent_ko);			break;		case StaticData.ENGLISH:			this.btn_back.setImageResource(R.drawable.b_back_en);			this.total_title.setText(R.string.survey_en);			this.btn_pre.setImageResource(R.drawable.b_prev_en);			this.btn_next.setImageResource(R.drawable.b_next_en);			this.btn_final.setImageResource(R.drawable.b3_confirm_en);			this.info_draftsman.setText(R.string.draftsman_en);			this.info_respondent.setText(R.string.respondent_en);			this.text_wait.setText(R.string.wait_en);			break;		case StaticData.CHINA:			this.btn_back.setImageResource(R.drawable.b_back_cn);			this.total_title.setText(R.string.survey_cn);			this.btn_pre.setImageResource(R.drawable.b_prev_cn);			this.btn_next.setImageResource(R.drawable.b_next_cn);			this.btn_final.setImageResource(R.drawable.b3_confirm_cn);			this.info_draftsman.setText(R.string.draftsman_cn);			this.info_respondent.setText(R.string.respondent_cn);			this.text_wait.setText(R.string.wait_cn);			break;		}	}	@Override	public void setEventListener() {		// back key		this.btn_back.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View v) {				Intent intent = new Intent(getApplicationContext(), Survey_Activity.class);				startActivity(intent);				finish();			}		});				// pre		this.btn_pre.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View v) {				pager.setCurrentItem(nowSelectPosition-1);				modifyButtonState();			}		});		// next		this.btn_next.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View v) {				pager.setCurrentItem(nowSelectPosition+1);				modifyButtonState();			}		});		// final		this.btn_final.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View v) {			}		});	}		public void updateUI(){		this.RESEARCH_TITLE.setText(item.RESEARCH_TITLE);		this.RESEARCH_MAKER.setText(item.RESEARCH_MAKER);		this.RESEARCH_TOTAL_COUNT.setText(item.RESEARCH_TOTAL_COUNT+"");		setViewPagerAdapter();	}		GestureDetector gd;	int nowSelectPosition =0;	public void setViewPagerAdapter(){		this.adapter = new SurveyResultViewPagerAdapter(getApplicationContext(), item.RESEARCH_QUESTION, this);		this.pager.setAdapter(adapter);		gd = new GestureDetector(new SimpleOnGestureListener());		this.pager.setOnTouchListener(new OnTouchListener() {			@Override			public boolean onTouch(View v, MotionEvent event) {				gd.onTouchEvent(event);				return true;			}		});		this.modifyButtonState();//		pager.setCurrentItem(position, true);			}		public void modifyButtonState(){		if(item.RESEARCH_QUESTION.size() != 0){			this.nowSelectPosition = this.pager.getCurrentItem();			if(item.RESEARCH_QUESTION.size() == 1){				this.btn_pre.setVisibility(Button.GONE);				this.btn_next.setVisibility(Button.GONE);				this.btn_final.setVisibility(Button.GONE);			}else{				if(nowSelectPosition == 0){					this.btn_pre.setVisibility(Button.INVISIBLE);					this.btn_next.setVisibility(Button.VISIBLE);					this.btn_final.setVisibility(Button.GONE);				}else if(nowSelectPosition == (item.RESEARCH_QUESTION.size()-1)){					this.btn_pre.setVisibility(Button.VISIBLE);					this.btn_next.setVisibility(Button.INVISIBLE);					this.btn_final.setVisibility(Button.GONE);		// 결과 확인이기때문에 필요없는 버튼				}else{					this.btn_pre.setVisibility(Button.VISIBLE);					this.btn_next.setVisibility(Button.VISIBLE);					this.btn_final.setVisibility(Button.GONE);				}			}		}	}		// back ground	class setSurveyResult extends WeakAsyncTask<Void, Void, Void,Activity>{		public setSurveyResult(Activity target) {			super(target);			// TODO Auto-generated constructor stub		}		boolean result;				@Override		protected void onPreExecute(Activity target) {			layout_progressbar.setVisibility(LinearLayout.VISIBLE);		}		@Override		protected Void doInBackground(Activity target,Void... params) {			SurveyDAO dao = new SurveyDAO(SurveyResult_Activity.this);			try {				result = dao.setSurveyResult(research_id);			} catch (Exception e) {				result = false;			}			if(result){				item = new SurveyResultDTO();				item = dao.getSurveyResult();			}			return null;		}				@Override		protected void onPostExecute(Activity target,Void result) {			if(this.result){				updateUI();			}else{				switch (StaticData.NOWLANGUAGE) {				case StaticData.KOREA:				Toast.makeText(getApplicationContext(),				R.string.please_retry_ko, Toast.LENGTH_SHORT).show();				break;				case StaticData.ENGLISH:				Toast.makeText(getApplicationContext(),				R.string.please_retry_en, Toast.LENGTH_SHORT).show();				break;				case StaticData.CHINA:				Toast.makeText(getApplicationContext(),				R.string.please_retry_cn, Toast.LENGTH_SHORT).show();				break;				}			}			setEventListener();			layout_progressbar.setVisibility(LinearLayout.GONE);		}	}		}